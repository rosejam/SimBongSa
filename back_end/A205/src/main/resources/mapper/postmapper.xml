<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.a205.model.postmapper">
	
	<select id="searchMyFeed" resultType="int"
		parameterType="java.util.Map">
		select p_id from `post`
		where m_id in (select f_followee_id
		from follow
		where f_follower_id = #{m_id})
		order by p_date desc
		limit #{listSize} offset #{startList};
	</select>
	
	<select id="searchVolFeed" resultType="int"
		parameterType="java.util.Map">
		select p_id from `post`
		where v_id = #{v_id}
		and p_status != 0
		order by p_date desc
		limit #{listSize} offset #{startList};
	</select>
	
	<select id="nextPostId" resultType="int">
		select max(p_id) from
		`post`;
	</select>

	<select id="selectOne" resultType="post" parameterType="int">
		select *
		from post
		where p_id = #{p_id}
	</select>

	<select id="postnameList" resultType="java.lang.String"
		parameterType="int">
		select p_id
		from post
		where m_id = #{m_id}
	</select>


	<!-- 포스트 검색?? -->
	<select id="searchByCondition" resultType="post"
		parameterType="java.util.Map">
		select * from post
		<where>
			<choose>
				<when test="condition=='title'">
					title like #{key}
				</when>
				<when test="condition=='content'">
					content like #{key}
				</when>
				<otherwise>

				</otherwise>
			</choose>
		</where>
	</select>


	<insert id="insertPostVote" parameterType="post_vote">
		insert into
		post_vote(p_id, m_id)
		values(#{p_id}, #{m_id})
	</insert>



	<update id="update" parameterType="post">
		update post set
		v_id = #{v_id},
		p_content = #{p_content},
		p_status = #{p_status}
		where p_id = #{p_id}
	</update>

	<delete id="delete" parameterType="int">
		delete from post
		where p_id =
		#{p_id}
	</delete>

	<delete id="deletePostVote" parameterType="post_vote">
		delete from post_vote
		where p_id = #{p_id} and m_id = #{m_id} 
	</delete>
	
	<insert id="insert" parameterType="post">
		insert into
		post(v_id,
		p_content, m_id, p_status)
		values(#{v_id}, #{p_content}, #{m_id},
		#{p_status})
	</insert>

	<!-- <select id="getViewCnt" parameterType="int"> select viewcnt from post 
		where no = #{id} </select> <update id="addViewCnt" parameterType="int"> update 
		post set viewcnt=viewcnt+1 where no = #{id} </update> <select id="getBoardList" 
		resultType="post"> SELECT * FROM post ORDER BY no DESC LIMIT #{startList}, 
		#{listSize} </select> <select id="getBoardListCnt" resultType="int"> SELECT 
		count(*) as listCnt FROM post </select> -->
</mapper>